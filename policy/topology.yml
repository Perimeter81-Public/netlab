defaults.device: frr

provider: clab
defaults.providers.clab.bridge_type: ovs-bridge

module: [ bgp ]

nodes:
  rtr1:
    bgp.as: 65001
    bgp.advertise_loopback: True
    config: ['device_config/rtr1.j2']
    id: 1
    loopback:
      ipv4: 10.0.0.1/32
  rtr2:
    bgp.as: 65001
    bgp.advertise_loopback: True
    config: ['device_config/rtr2.j2']
    id: 2
    loopback:
       ipv4: 10.0.0.2/32
  isp1:
    bgp.originate: [ 172.16.2.0/24 ]
    bgp.as: 64512

  isp2:
    bgp.originate: [ 172.16.3.0/24 ]
    bgp.as: 64513

  c1:
    device: linux
    id: 5

  c2:
    device: linux
    id: 6

  h3:
    device: linux
    id: 7

  h4:
    device: linux
    id: 8


links:
- rtr1-rtr2
- rtr1-isp1
- rtr2-isp2
- rtr1-c1
- rtr2-c2
- isp1-h3
- isp2-h4


validate:
   wait:
    description: Waiting for BGP to stabilize
    wait: 45

   ping1:
    description: c1 Ping to H3
    nodes: [ c1 ]
    devices: [ linux ]
    exec: ping -c 5 -W 1 -A h3
    valid: |
      "64 bytes" in stdout

   ping2:
    description: c2 Ping to H4
    nodes: [ c2 ]
    devices: [ linux ]
    exec: ping -c 5 -W 1 -A h4
    valid: |
      "64 bytes" in stdout

   ping3:
    description: c1 Ping to c2
    nodes: [ c1 ]
    devices: [ linux ]
    exec: ping -c 5 -W 1 -A c2
    valid: |
      "64 bytes" in stdout

   ping4:
    description: c1 Ping to H4
    nodes: [ c1 ]
    devices: [ linux ]
    exec: ping -c 5 -W 1 -A h4
    valid: |
      "64 bytes" in stdout

   ping5:
    description: c2 Ping to H3
    nodes: [ c2 ]
    devices: [ linux ]
    exec: ping -c 5 -W 1 -A h3
    valid: |
      "64 bytes" in stdout
